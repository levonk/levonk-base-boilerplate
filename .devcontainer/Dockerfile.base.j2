FROM scratch
{% if use_devcontainer %}
# Base image (Agent OS)
FROM {{ agent_os_repository }}:{{ agent_os_tag }}

# Install basics
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
       ca-certificates curl git sudo bash \
    && rm -rf /var/lib/apt/lists/*

# Create dev user/group
ARG USER={{ container_user }}
ARG GROUP={{ container_group }}
ARG UID={{ container_user_id }}
ARG GID={{ container_group_id }}

RUN groupadd -g ${GID} ${GROUP} \
    && useradd -m -s /bin/bash -u ${UID} -g ${GID} ${USER} \
    && echo "${USER} ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/${USER}

USER ${USER}
WORKDIR /home/${USER}
{% endif %}
